<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Set Meeting</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript">
var start_time;
var end_time;
var list=[];

function checkStart() {
    if(list.length!=0)
    {
    if (confirm('Are you sure this will delete all added member')) {
    list.length=0;
    $("p").empty();
    start_time = $("#stMeeting").val();
    }
    else
    {
    $("#stMeeting").val(start_time);
    }
  }
  else{
  start_time = $("#stMeeting").val();
  }
}
function checkEnd() {

    if(list.length!=0)
    {
    if (confirm('Are you sure this will delete all added member')) {
    list.length=0;
    $("p").empty();
    end_time = $("#edMeeting").val();
    }
    else
    {
    $("#edMeeting").val(end_time);
    }
  }
  else{
  end_time = $("#edMeeting").val();
  }
}

$(document).ready(function(){

    $("#add").click(function(){

        var timing={
            "stDate":$("#stMeeting").val(),
            "edDate":$("#edMeeting").val()
         };
        var m=$('#member').val();
        if (!start_time && !end_time) {alert("Enter Valid Timing");}

        else if(m=="")  {alert("Enter Email"); }

        else if(list.includes(m))   {alert("Already included");}

        else{
        $.ajax({
            url: "/check/"+m,
            type: 'POST',
            data:  JSON.stringify(timing),
            dataType: "json",
            contentType: 'application/json',
            mimeType: 'application/json',
            success: function(data){
            if(data==true)
            {
                $("p").append("<ol>"+m+"</ol>");
                list.push(m);
            }
            else
            {
                alert("He is not available");
            }
            }
            });
        }
        $('#member').val("");
    });

    $("#set").click(function(){

        var timing={
            "stDate":$("#stMeeting").val(),
            "edDate":$("#edMeeting").val()
        };
        var Meeting = JSON.stringify({
            'hostId':"Prashu1996@gmail.com",
            'members' : list,
            'timing':timing
        });
        $.ajax({
            url: "/set_meeting",
            type: 'POST',
            data:  Meeting,
            dataType: "html",
            contentType: 'application/json',
            mimeType: 'application/json',
            success: function(){
                alert("Successfully Set Meeting");
            }
        });
        });

});

</script>
</head>
<body class="jumbotron">
<div align="center" >
<h1> Set Meeting</h1>
Start Meeting:
<input type="datetime-local" id="stMeeting" onfocusout="checkStart()" >
<br>
End Meeting  :
<input type="datetime-local" id="edMeeting" onfocusout="checkEnd()">
<br><br><br>

<input type="text" id="member" placeholder="Member">
<button id="add" class="btn btn-success">Add Member</button>
<P>Members</p>
<br><br>
<button id="set" class="btn btn-success">Set Meeting</button>
</div>
</body>
</html>